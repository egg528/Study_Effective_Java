# Item49. 매개변수가 유효한지 검사하라

### 문제 상황 - 메서드 혹은 생성자의 매개변수를 제대로 검사하지 않는다면

1. 메서드 수행 중간에 모호한 예외를 던질 수 있다.
2. 메서드는 정상 작동하고, 잘못된 결과를 던질 수 있다.
3. 정상 작동하고 결과를 던진 반환한 후,,, 먼 미래에 문제가 발생할 수 있다.





### 매개변수로 잘못된 값이 들어와 생기는 문제를 방지하려면 어떻게 해야할까?

#### `Sol1: 매개변수 값이 잘못됐을 때 던지는 예외를 문서화하라`

```java
/**
 * 항상 음이 아닌 BigInteger를 반환한다는 점에서 remainder 메서드와 다르다.
 *
 * @param m 계수 (양수여야 한다.)
 * @return 현재 값 mod m
 * @throws ArithmeticException m이 0보다 작거나 같으면 발생한다. 
 */
public BigInteger mod(BigInteger m) {
        if (m.signum() <= 0)
        throw new ArithmeticException("계수(m)는 양수여야 합니다. " + m);
        // 계산 수행 
}
```





####  `Sol2: Null 검사를 수행하라`

```java
public final class Objects {

  // 1
  public static <T> T requireNonNull(T obj) {
    if (obj == null)
      throw new NullPointerException();
    return obj;
  }

  // 2. 메세지 자체를 전달
  public static <T> T requireNonNull(T obj, String message) {
    if (obj == null)
      throw new NullPointerException(message);
    return obj;
  }

  // 3. 메세지를 반환하는 Supplier 객체를 전달받아 lazy 하게 작동한다.
  //    즉, Null 체크가 이뤄질 때까지 message 선택을 미룰 수 있다.
  public static <T> T requireNonNull(T obj, Supplier<String> messageSupplier) {
    if (obj == null)
      throw new NullPointerException(messageSupplier == null ?
         null : messageSupplier.get());
    return obj;
  }
}
```

- requireNonNull 메서드를 활용해 효과적으로 매개변수의 Null 여부를 확인할 수 있고 적절한 예외 메시지도 출력할 수 있다.



#### `Sol3: Assert를 활용하라`

```java
private static void sort(long a[], int offset, int length) {
    assert a != null;
    assert offset >= 0 && offset <= a.length;
    assert length >= 0 && length <= a.length - offset;

    ...
}

assert [Boolean] // 참이면 Pass, 거짓이면 AssertionError
```

- Assert - 개발/테스트 단계에서 파라미터가 제대로 넘어왔는지, 계산이 제대로 됐는지 혹은 특정 메소드가 작동하는 한계상황(Null이 들어오면 작동안함)을 정하는 용도로 사용한다.
- assert를 사용하기 위해서는 프로그램 실행시 옵션을 추가해야 한다.
  - 옵션
    - 유효성 검사를 포함할 경우 : `-enableassertions`, `-ea`
    - 유효성 검사를 배제할 경우 : `-disableassertions`, `-da`





#### `참고`

- 메서드가 직접 사용하지는 않으나 나중에 쓰기 위해 저장하는 매개변수는 특히 더 신경써서 검사해야 한다.
- "유효성 검사 비용이 지나치게 높은 경우" 혹은 "계산 과정에서 암묵적으로 검사가 가능한 경우" 유효성 검사 적용에 대해 고민해볼 것.
- 메서드가 제대로 동작하는 범위에서 매개변수 제약은 적을 수록 좋다.
  - 단, 잘못된 매개변수에 의해 메서드가 제대로 동작하지 않는 상황에 대한 처리가 필요할 뿐이다.